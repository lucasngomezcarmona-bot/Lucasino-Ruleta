<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ruleta</title>
<style>
    body {
        background: orange;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        font-family: Arial, sans-serif;
        overflow: hidden;
    }

    #coins {
        font-size: 30px;
        margin-bottom: 20px;
        font-weight: bold;
        color: white;
        text-shadow: 2px 2px 4px black;
    }

    #wheelContainer {
        position: relative;
        width: 300px;
        height: 300px;
        margin-bottom: 20px;
    }

    #wheel {
        width: 100%;
        height: 100%;
        border: 12px solid yellow;
        border-radius: 50%;
        transition: transform 4s ease-out;
    }

    /* Flecha estilo casino */
    #sidePointer {
        position: absolute;
        right: -40px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-top: 25px solid transparent;
        border-bottom: 25px solid transparent;
        border-right: 40px solid gold;
        filter: drop-shadow(0 0 6px white);
    }

    #spinButton {
        background: red;
        color: white;
        border: 4px solid white;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        transition: 0.2s;
    }

    #spinButton:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px white;
    }

    /* Partículas */
    .particle {
        position: absolute;
        width: 8px;
        height: 8px;
        background: yellow;
        border-radius: 50%;
        pointer-events: none;
        animation: particleAnim 0.8s ease-out forwards;
    }

    @keyframes particleAnim {
        from { opacity: 1; transform: translate(0,0) scale(1); }
        to { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0); }
    }

</style>
</head>
<body>

<div id="coins">Monedas: 100</div>

<div id="wheelContainer">
    <canvas id="wheel" width="300" height="300"></canvas>

    <!-- Flecha derecha estilo casino -->
    <div id="sidePointer"></div>
</div>

<button id="spinButton">Girar</button>

<script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinButton = document.getElementById("spinButton");
    const coinsText = document.getElementById("coins");

    let coins = 100;

    // Sectores
    const sectors = [
        { label: "x4", color: "green", prob: 0.10, mult: 4 },
        { label: "x3", color: "green", prob: 0.15, mult: 3 },
        { label: "x2", color: "green", prob: 0.20, mult: 2 },
        { label: "x0.4", color: "red", prob: 0.55, mult: 0.4 }
    ];

    // Convertir probabilidad a ángulo
    let angles = [];
    let startAngle = 0;
    sectors.forEach(sec => {
        const angle = sec.prob * Math.PI * 2;
        angles.push({ ...sec, start: startAngle, end: startAngle + angle });
        startAngle += angle;
    });

    // Dibujar ruleta
    function drawWheel() {
        angles.forEach(sec => {
            ctx.beginPath();
            ctx.moveTo(150, 150);
            ctx.arc(150, 150, 140, sec.start, sec.end);
            ctx.fillStyle = sec.color;
            ctx.fill();
            ctx.save();

            ctx.translate(150, 150);
            ctx.rotate((sec.start + sec.end) / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.fillText(sec.label, 120, 10);
            ctx.restore();
        });
    }
    drawWheel();

    let spinning = false;
    let currentAngle = 0;

    // Partículas al ganar
    function spawnParticles() {
        for (let i = 0; i < 20; i++) {
            const p = document.createElement("div");
            p.classList.add("particle");

            const angle = Math.random() * Math.PI * 2;
            const distance = 80 + Math.random() * 40;

            p.style.setProperty('--dx', Math.cos(angle) * distance + "px");
            p.style.setProperty('--dy', Math.sin(angle) * distance + "px");

            p.style.left = (window.innerWidth / 2) + "px";
            p.style.top = (window.innerHeight / 2 - 50) + "px";

            document.body.appendChild(p);

            setTimeout(() => p.remove(), 800);
        }
    }

    function spinWheel() {
        if (spinning) return;
        spinning = true;

        const spinAmount = Math.random() * Math.PI * 2 + Math.PI * 6;
        currentAngle += spinAmount;

        canvas.style.transition = "transform 4s ease-out";
        canvas.style.transform = `rotate(${currentAngle}rad)`;

        setTimeout(() => {
            let finalAngle = (currentAngle % (Math.PI * 2));

            // Como la flecha está a la DERECHA, el ángulo coincide con 0 rad apuntando a la izquierda
            // Ajustar referencia
            finalAngle = finalAngle;

            // Evitar zona exacta entre sectores
            finalAngle += 0.0001;
            if (finalAngle >= Math.PI * 2) finalAngle -= Math.PI * 2;

            // Buscar sector
            let result = angles.find(
                sec => finalAngle >= sec.start && finalAngle < sec.end
            );

            // Aplicar multiplicador
            coins = Math.floor(coins * result.mult);
            coinsText.textContent = "Monedas: " + coins;

            // Partículas si ganas
            if (result.mult >= 2) spawnParticles();

            spinning = false;
        }, 4000);
    }

    spinButton.addEventListener("click", spinWheel);
</script>

</body>
</html>
