<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Ruleta Casino</title>
<style>
    body {
        margin: 0;
        background: orange;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial, sans-serif;
        color: white;
        overflow: hidden;
    }

    #coins {
        font-size: 40px;
        font-weight: bold;
        text-shadow: 3px 3px 5px black;
        margin-bottom: 20px;
    }

    canvas {
        border: 10px solid #FFD700;
        border-radius: 50%;
        background: #222;
    }

    #controls {
        margin-top: 20px;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    /* Botón Girar */
    #spinBtn {
        width: 130px;
        height: 130px;
        border-radius: 50%;
        background: red;
        border: 5px solid white;
        color: white;
        font-size: 25px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 0 20px black;
    }

    #spinBtn:active {
        transform: scale(0.95);
    }

    /* Botón +5 */
    #addBtn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #00dd00;
        border: 4px solid white;
        color: white;
        font-size: 22px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 0 15px black;
    }

    #addBtn:active {
        transform: scale(0.9);
    }

    /* Flecha a la derecha */
    .arrow {
        width: 0;
        height: 0;
        border-top: 25px solid transparent;
        border-bottom: 25px solid transparent;
        border-left: 35px solid yellow;
        position: absolute;
        right: calc(50% - 235px);
        top: 50%;
        transform: translateY(-50%);
        filter: drop-shadow(0 0 10px yellow);
    }
</style>
</head>
<body>

<div id="coins">Monedas: 100</div>
<div class="arrow"></div>
<canvas id="wheel" width="500" height="500"></canvas>

<div id="controls">
    <button id="spinBtn">Girar</button>
    <button id="addBtn">+5</button>
</div>

<script>
let canvas = document.getElementById("wheel");
let ctx = canvas.getContext("2d");

let coins = 100;
document.getElementById("coins").textContent = "Monedas: " + coins;

let currentAngle = 0;
let spinning = false;

const sectors = [
    { text: "x4",   color: "green", angle: Math.PI * 0.2 },  // 10%
    { text: "x3",   color: "green", angle: Math.PI * 0.3 },  // 15%
    { text: "x2",   color: "green", angle: Math.PI * 0.4 },  // 20%
    { text: "x0.4", color: "red",   angle: Math.PI * 1.1 }   // 55%
];

function drawWheel() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(250, 250);
    ctx.rotate(currentAngle);

    let start = 0;
    sectors.forEach(s => {
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.fillStyle = s.color;
        ctx.arc(0, 0, 220, start, start + s.angle);
        ctx.fill();

        ctx.save();
        ctx.rotate(start + s.angle / 2);
        ctx.fillStyle = "white";
        ctx.font = "30px Arial";
        ctx.fillText(s.text, 110, 10);
        ctx.restore();

        start += s.angle;
    });

    ctx.restore();
}

/* Detectar sector ganador */
function getResult() {
    let angle = (currentAngle % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);
    let pointerAngle = (Math.PI * 2) - angle;

    let accum = 0;
    for (let s of sectors) {
        accum += s.angle;
        if (pointerAngle <= accum) return s;
    }
    return sectors[sectors.length - 1];
}

/* Partículas al ganar */
function spawnParticles() {
    for (let i = 0; i < 25; i++) {
        const p = document.createElement("div");
        p.style.position = "absolute";
        p.style.width = "10px";
        p.style.height = "10px";
        p.style.borderRadius = "50%";
        p.style.background = "white";
        p.style.left = "50%";
        p.style.top = "50%";
        p.style.pointerEvents = "none";
        p.style.opacity = "1";
        document.body.appendChild(p);

        let angle = Math.random() * Math.PI * 2;
        let speed = 4 + Math.random() * 4;

        let vx = Math.cos(angle) * speed;
        let vy = Math.sin(angle) * speed;

        let interval = setInterval(() => {
            let rect = p.getBoundingClientRect();
            p.style.left = rect.left + vx + "px";
            p.style.top = rect.top + vy + "px";
            p.style.opacity -= 0.03;
            if (p.style.opacity <= 0) {
                clearInterval(interval);
                p.remove();
            }
        }, 16);
    }
}

function spin() {
    if (spinning) return;
    spinning = true;

    let spinAmount = (Math.random() * Math.PI * 2) + (Math.PI * 6);
    let duration = 2500;
    let start = performance.now();

    function animate(now) {
        let progress = (now - start) / duration;
        if (progress >= 1) progress = 1;

        currentAngle += (spinAmount * (1 - Math.pow(progress, 3))) * 0.05;

        drawWheel();

        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            let result = getResult();
            if (result.text === "x0.4") {
                coins = Math.floor(coins * 0.4);
            } else {
                coins = Math.floor(coins * Number(result.text.substring(1)));
                spawnParticles();
            }
            document.getElementById("coins").textContent = "Monedas: " + coins;
            spinning = false;
        }
    }

    requestAnimationFrame(animate);
}

/* Botón +5 */
document.getElementById("addBtn").onclick = () => {
    coins += 5;
    document.getElementById("coins").textContent = "Monedas: " + coins;
};

document.getElementById("spinBtn").onclick = spin;

drawWheel();
</script>

</body>
</html>
